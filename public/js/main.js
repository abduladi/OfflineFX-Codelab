"use strict";function FX(){this.baseCurrency="USD",this.listEl=fxList}FX.prototype._createFXCard=function(e){var n=e.base.currency+"-"+e.compare.currency,t='<li class="fx" id="'+n+'">\n                    <div class="rates">\n                        <div class="rate rate__base">\n                            <span class="fx__currency">'+currencyInformation[e.base.currency].name_plural+'</span>\n                            <span class="fx__amount">\n                              '+currencyInformation[e.base.currency].symbol+"\n                              "+e.base.amount+'\n                            </span>\n                        </div>\n                        <div class="rate rate__compare">\n                            <span class="fx__currency">'+currencyInformation[e.compare.currency].name_plural+'</span>\n                            <span class="fx__amount">\n                              '+currencyInformation[e.compare.currency].symbol+"\n                              "+e.compare.amount+'\n                            </span>\n                        </div>\n                    </div>\n                    <div class="converter">\n                        <div class="exchange exchange__base" data-rate="'+e.base.amount+'">\n                            <input type="number" value="'+e.base.amount+'" data-parent-id="'+n+'"/>\n                        </div>\n                        <div class="exchange exchange__compare" data-rate="'+e.compare.amount+'">\n                            <input type="number" value="'+e.compare.amount+'" data-parent-id="'+n+'"/>\n                        </div>\n                    </div>\n                    <div class="actions">\n                        <div>\n                            <button type="button" class="btn btn-convert">\n                                <img src="./img/icon-convert.png" alt="" />\n                                Convert\n                            </button>\n                        </div>\n                        <div>\n                            <button type="button" class="btn btn-remove">\n                                <img src="./img/icon-delete.png" alt="" />\n                                Remove\n                            </button>\n                        </div>\n                    </div>\n                </li>';fxList.insertAdjacentHTML("afterbegin",t)},FX.prototype._addEventListeners=function(){var e=function(e,n){var t=parseFloat(e.value),r=parseFloat(document.querySelector("#"+e.dataset.parentId+" .exchange__compare").dataset.rate);switch(n){case"compare":var e=document.querySelector("#"+e.dataset.parentId+" .exchange__"+n+" input");e.value=t*r;break;case"base":var e=document.querySelector("#"+e.dataset.parentId+" .exchange__"+n+" input");e.value=t/r}},n=function(e){e=e.split("-")[1],offlineFXDatabase.remove("CompareCurrencies",null,"currency",e).then(function(){return myFX.init()})},t=document.querySelectorAll(".fx");t.forEach(function(t){var r=t.getAttribute("id"),a=document.querySelector("#"+r+" .exchange__base input");a.addEventListener("keyup",function(n){e(n.target,"compare")});var o=document.querySelector("#"+r+" .exchange__compare input");o.addEventListener("keyup",function(n){e(n.target,"base")});var c=document.querySelector("#"+r+" .btn-convert");c.addEventListener("click",function(e){document.querySelector("#"+r+" .converter").classList.toggle("open")});var i=document.querySelector("#"+r+" .btn-remove");i.addEventListener("click",function(e){n(r)})})},FX.prototype._createFXObjects=function(e){var n=moment(e.clientTimestamp).calendar(null,{sameDay:"[Today at] h:mma",nextDay:"[Tomorrow at] h:mma",nextWeek:"[Next] dddd [at] h:mma",lastDay:"[Yesterday at] h:mma",lastWeek:"[Last] dddd [at] h:mma",sameElse:"[on] dddd Do MMMM [at] h:mma"}),t=document.querySelector(".last-updated");t.innerHTML="Last updated: "+n,this.listEl.innerHTML="";var r=[];for(var a in e.quotes)r.push({base:{currency:this.baseCurrency,amount:"1"},compare:{currency:a.split(this.baseCurrency)[1],amount:parseInt(e.quotes[a]).toFixed(2)}});r.map(this._createFXCard),this._addEventListeners()},FX.prototype._handleEmptyState=function(){new Toast("success","Looks like you haven't set any currencies yet. Press the + to get started!")},FX.prototype._fetchAndSave=function(e,n){return fetch(e).then(function(e){return e.json()}).then(function(t){t.url=e,t.clientTimestamp=(new Date).getTime();var r=Promise.resolve();return n&&(r=r.then(function(){return offlineFXDatabase.remove("FX","url","url",e)})),r=r.then(function(){return offlineFXDatabase.add("FX",t).then(function(){return Promise.resolve(t)})})})},FX.prototype._doBackgroundUpdate=function(e){var n=this;this._fetchAndSave(e,!0).then(function(e){return n._createFXObjects(e)})["catch"](function(){console.log("looks like there's no wifi connnection to update in background")})},FX.prototype.init=function(){var e=this,n=!1,t=void 0;offlineFXDatabase.retrieve("CompareCurrencies").then(function(n){if(0==n.length)return e._handleEmptyState(),Promise.reject({displayErrorMessage:!1});var r=n.map(function(e){return e.currency}).join(",");return t=API_URL+"&currencies="+r,Promise.resolve(t)}).then(function(e){return offlineFXDatabase.retrieve("FX","url",e)}).then(function(r){return r.length>0?(n=!0,Promise.resolve(r[0])):e._fetchAndSave(t)}).then(function(n){return e._createFXObjects(n)}).then(function(){if(n)return e._doBackgroundUpdate(t)})["catch"](function(e){e.displayErrorMessage!==!1&&new Toast("error","Uh oh, there was an error fetching information")})};var API_URL="https://www.apilayer.net/api/live?access_key=22792a6f299a6da5430ab12df828e169&format=1",fxList=document.getElementById("fxList"),compareCurrencySelectEl=document.getElementById("compare_currency"),myDialog=new Dialog(document.querySelector(".dialog"),document.querySelector(".dialog-overlay"));myDialog.addEventListeners(".open-dialog",".close-dialog");var offlineFXDatabase=new IDB,myFX=new FX;myFX.init();var currencyInformation=void 0;fetch("./data/Common-Currency.json").then(function(e){return e.json()}).then(function(e){currencyInformation=e;for(var n in e)if(n!==myFX.baseCurrency){var t='<option value="'+e[n].code+'">'+e[n].name_plural+"</option>";compareCurrencySelectEl.insertAdjacentHTML("afterbegin",t)}});var addCurrencyForm=document.getElementById("addCurrencyForm");addCurrencyForm.addEventListener("submit",function(e){e.preventDefault(),offlineFXDatabase.add("CompareCurrencies",{currency:document.getElementById("compare_currency").value}).then(function(){myFX.init(),new Toast("success","New currency added!")})["catch"](function(e){new Toast("error","There was an error adding this currency. Please try again")})});